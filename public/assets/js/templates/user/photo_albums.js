
(function($){'use strict';var Engine={isotope:function(){var $photos=$('#photos');if($photos.imagesLoaded){$photos.imagesLoaded(function(){$photos.isotope({itemSelector:'.item',masonry:{columnWidth:190}});});}},itemClick:function(){var $items=$('#photos .item');$('.thumb',$items).click(function(){var $this=$(this).parent(),bigWidth=552,width=172,$inactiveItems;$items.not(this).removeClass('active');$this.css('width',bigWidth).toggleClass('active');$('h4',$this).addClass('big-caption');$('.credits',$this).show();$('.desc',$this).show();$('.thumb',$this).hide();$('.image-stack',$this).show();$inactiveItems=$items.not('.active');$inactiveItems.css('width',width);$('h4',$inactiveItems).removeClass('big-caption');$('.credits',$inactiveItems).hide();$('.desc',$inactiveItems).hide();$('.image-stack',$inactiveItems).hide();$('.thumb',$inactiveItems).show();$('#photos').isotope('reLayout');});},addNewAlbum:function(){$('#addNewAlbum').button().click(function(){var time_stamp=(new Date()).getTime(),key="main_image"+time_stamp,data={},postData;data[key]=base64.encode(JSON.stringify([]));postData='data='+JSON.stringify(data);postData+="&pid="+coreEngine.pageID;coreEngine.ajax("article/save",postData,function(){window.location.reload(false);});});},removeAlbum:function(){var $btnRemove=$('<button>',{'text':'Remove Album','class':'btn-remove'});$('#photos > .image-stack > ul').append($btnRemove);$('#photos > .image-stack > ul > .btn-remove').button().click(function(){var album_id=$(this).closest('.edit_img').attr('id'),postData;if(window.confirm('Are you sure?')===true){postData='key='+album_id;postData+="&pid="+coreEngine.pageID;coreEngine.ajax("article/removeelement/"+(new Date()).getTime(),postData,function(){window.location.reload(false);},"json");}});},columnize:function(){var $context,$tmp,numColumns;if($(".ui-tabs-nav").length>0){$context=$($(".ui-tabs-nav .ui-state-active a").attr('href'));}else{$context=$('div.photo-albums');}
$tmp=$('.article',$context);numColumns=window.parseInt($('.page-columns',$context).text());if($tmp.columnize){if(numColumns>1){$tmp.columnize({columns:numColumns});$(".column",$context).width(Math.floor($tmp.width()/numColumns-(21-21/numColumns)));}}else{numColumns=String(numColumns);$tmp.css({'-webkit-column-count':numColumns,'-webkit-column-rule':'1px dotted #BBBBBB','-webkit-column-gap':'24px','-moz-column-count':numColumns,'-moz-column-rule':'1px dotted #BBBBBB','-moz-column-gap':'24px','column-count':numColumns,'column-rule':'1px dotted #BBBBBB','column-gap':'24px'});}}};$(document).ready(function(){Engine.isotope();Engine.itemClick();Engine.addNewAlbum();Engine.removeAlbum();Engine.columnize();});}(jQuery));