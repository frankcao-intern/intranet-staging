
require(['jquery','lib/jquery.dataTables','lib/jquery.myeditable'],function($){"use strict";var Engine={initTable:function(){$('#dataTable').dataTable({"sScrollX":"960","bScrollCollapse":true,"bJQueryUI":true,"sPaginationType":"full_numbers","fnDrawCallback":function(){$('#dataTable').find('tbody td').editable({type:"textInline",save:function(){var tdFirst=$('td:first',$(this).parent()),data={};data.table_key=tdFirst.data('key');data.table_key_val=tdFirst.find('div').text();data.key=$(this).data('key');data.val=base64.encode($(this).children('div').text());data.table_name=$('#tableName').text();coreEngine.ajax('crud/save',"data="+JSON.stringify(data),coreEngine.genericCallBack);},saveText:"Save",cancelText:"Cancel",showLink:false});}});},addButton:function(){var $dialog=$("#addNewDiag"),fields=[],width;width=0;$(".dataTable:first thead th").each(function(){fields.push({"fname":$(this).text()});});$(coreEngine.attachTemplateToData($("#formTempl").html(),fields)).appendTo($('.field-group-a',$dialog));$(".field label",$dialog).css("width","auto").each(function(){if($(this).width()>width){width=$(this).width();}}).css("width",width);$dialog.dialog({autoOpen:false,buttons:{"Create":function(){$('form',this).submit();},"Cancel":function(){$(this).dialog('close');}}});$("#addNew").button().click(function(){$("#addNewDiag").find(".field input").val('').end().dialog('open');});},deleteRow:function(){$('#dataTable').selectable({filter:"tbody tr",distance:2});$(document).click(function(){$('#dataTable').find('tbody tr').removeClass('ui-selected');});$("#deleteSelected").button().click(function(){var $selected=$("#dataTable").find(".ui-selected").addClass('js-deleted'),tdFirst=$('td:first',$selected),data={};if(window.confirm("Deletions are permanent. Are you sure?")===true){$selected.hide();data.table_key=tdFirst.data('key');data.table_key_val=tdFirst.find('div').text();data.table_name=$('#tableName').text();coreEngine.ajax('crud/delete',"data="+JSON.stringify(data),function(result){var $dataTable=$("#dataTable");if((typeof result==='object')&&(result.isError===false)){$dataTable.find(".js-deleted").remove();}else{$dataTable.find(".js-deleted").removeClass('js-deleted').show();$.message(result.errorStr,'error');}});}});}};$(document).ready(function(){Engine.initTable();Engine.addButton();Engine.deleteRow();});});