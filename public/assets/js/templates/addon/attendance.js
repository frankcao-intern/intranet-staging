
(function($){"use strict";var Engine={selectable:function(){$('.attendance tbody').selectable({filter:'td',cancel:'.signed',selecting:function(){$('#dayTypes').hide();$('#actions').hide();},stop:function(e){var $selected=$('.attendance tbody .ui-selected');$selected.filter('.signed').removeClass('ui-selected');if($selected.not('.signed').length>0){$('#dayTypes').css({'top':e.pageY,'left':e.pageX}).show();}}});$('.attendance tfoot').selectable({filter:'td.planned',cancel:'.confirmed, .pending, .empty',selecting:function(){$('#dayTypes').hide();$('#actions').hide();$('.attendance td').removeClass('ui-selected');},stop:function(e){if($('.attendance tfoot .ui-selected').length>0){$('#actions').css({'top':e.pageY,'left':e.pageX}).show();}}});},hideMenu:function(){$(document).click(function(){$('#dayTypes').hide();$('#actions').hide();$('.attendance td').removeClass('ui-selected');});},dayTypes:function(){$('#dayTypes').find('a').click(function(){var $this=$(this),$td=$('.attendance tbody td.ui-selected'),type=$this.data('value'),status=$td.attr('class'),data=[],postData;$td.each(function(){var $this=$(this);data.push({day:$('th:first',$this.parent()).text(),month:$this.index(),type:type});});postData='data='+JSON.stringify(data);$td.addClass('js-pending');$('#dayTypes').hide();if($this.is('.delete')){$('.attendance tbody td.js-pending').removeClass('confirmed pending planned ui-state-warning');coreEngine.ajax('https://fishnet.eileenfisher.com/addon/attendance/delete',postData,function(result){var $pending=$('.attendance tbody td.js-pending');if(result.isError){$.message(result.errorStr,'error');$pending.addClass(status).removeClass('js-pending ui-selected');}else{$pending.text('').removeClass('js-pending');}},'json');}else if($this.is('.submit')){Engine.btnSend.submit();}else{$td.text(type).removeClass('confirmed pending ui-state-warning planned').addClass('planned js-pending');coreEngine.ajax('https://fishnet.eileenfisher.com/addon/attendance/save',postData,function(result){var $pending=$('.attendance tbody td.js-pending');if(result.isError){$.message(result.errorStr,'error');$pending.text('').removeClass('confirmed pending ui-state-warning planned js-pending');}else{$pending.removeClass('js-pending');}},'json');}});},calculateTotals:function(){$('.attendance tr.totals td').each(function(){var $this=$(this),index=$this.index()-1,confirmed;confirmed=$('.attendance tbody tr').find('td:eq('+index+')').filter('.confirmed').length;$this.text(confirmed);});},btnSend:{submit:function(){var $days=$('.attendance tbody td.ui-selected.planned'),status=$days.attr('class'),postData,data=[];if($days.length>0){$days.removeClass('confirmed planned').addClass('pending ui-state-warning');$days.each(function(){var $this=$(this),date='{1}-{2}-{3}',year=coreEngine.attendance.year,month=$this.index(),day=$('th:first',$this.parent()).text();data.push(date.format(year,month,day));});postData='data='+JSON.stringify(data)+'&user_id='+coreEngine.attendance.user_id;coreEngine.ajax('https://fishnet.eileenfisher.com/addon/daysout/request',postData,function(result){if(result.isError){$.message(result.errorStr,'error');$days.removeClass('pending').addClass(status);}else{$.message(result.data,'success');}},'json');}else{$.message('None of the selected days are marked, or are already confirmed.','error');}}},months:function(){$('#actions').find('a').click(function(){var $this=$(this),$month=$('.attendance tfoot .ui-selected.planned'),postData,data=[];$month.removeClass('planned').addClass('pending ui-state-warning js-pending');$('#actions').hide();if($this.is('.submit')){if($month.length>0){$month.each(function(){var $this=$(this),date="{1}-{2}-01",year,month;year=coreEngine.attendance.year;month=$this.index();data.push(date.format(year,month));});postData='data='+JSON.stringify(data)+'&user_id='+coreEngine.attendance.user_id;coreEngine.ajax('https://fishnet.eileenfisher.com/addon/attendance/sign_month',postData,function(result){if((typeof result==='object')&&(result.isError===false)){$.message('Your request was precessed successfully!','success');}else{$.message(result.errorStr,'error');$month.removeClass('pending');}},'json');}else{$.message('No months are selected.','error');}}});}};$(document).ready(function(){if((coreEngine.attendance.its_me===true)||(coreEngine.attendance.its_my_boss===true)){Engine.selectable();Engine.hideMenu();Engine.dayTypes();Engine.months();}
Engine.calculateTotals();$('.attendance .pending').addClass('ui-state-warning');});}(jQuery));